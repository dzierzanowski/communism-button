<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#CD0000">
    <link rel="canonical" href="https://dzierzanowski.github.io/communism-button/" />
    <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png">
    <link rel="apple-touch-icon" href="./images/homescreen192.png">
    <link rel="manifest" href="./manifest.json">
    <style type="text/css">
        @font-face {
            font-family: "Orelega One";
            src: url('./fonts/OrelegaOne-Regular.ttf');
        }
        *{
            font-family: Verdana, sans-serif;
            color: #FFD900;
        }
        body {
            padding: 0;
            margin: 0;
            background-color: #CD0000;
        }
        #container {
            display: flex;
            height: 100vh;
            width: 100vw;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }
        #content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            -webkit-filter: blur(0);
            filter: blur(0);
            opacity: 1;
            -webkit-transition: opacity 200ms ease, -webkit-filter 200ms ease;
                    transition: opacity 200ms ease, -webkit-filter 200ms ease;
                    transition: filter 200ms ease, opacity 200ms ease;
                    transition: filter 200ms ease, opacity 200ms ease, -webkit-filter 200ms ease;
        }
        #content.modal-active {
            -webkit-filter: blur(8px);
            filter: blur(8px);
            opacity: 0.4;
        }
        #button {
            width: 70vmin;
            border-radius: 50%;
            box-shadow: 1vmin 1vmin 2vmin #9c0000, -1vmin -1vmin 2vmin #fe0000;
            user-drag: none; 
            user-select: none;
            /*pointer-events: none;*/
            -moz-user-select: none;
            -webkit-user-drag: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
        #button.pressed {
            box-shadow: 0.3vmin 0.3vmin 0.6vmin #9c0000, -0.3vmin -0.3vmin 0.6vmin #fe0000;
        }
        #buttonLink {
            user-drag: none;
            user-select: none;
        }
        #modalButton {
            border-radius: 50%;
            margin-top: 4em;
            width: 15vmin;
            box-shadow: 0.5vmin 0.5vmin 1vmin #9c0000, -0.5vmin -0.5vmin 1vmin #fe0000;
            user-drag: none;
            user-select: none;
        }
        #modalButton.pressed {
            box-shadow: 0.2vmin 0.2vmin 0.4vmin #9c0000, -0.2vmin -0.2vmin 0.4vmin #fe0000;
        }
        #modal {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            z-index: 1;
            opacity: 1;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            /*background: none;*/
            background: rgb(135, 0, 0); /* backup */
            background: rgba(0, 0, 0, 0.4); /* backup */
            -webkit-transition: all 200ms ease;
                    transition: all 200ms ease;
        }
        #modal.hidden {
            visibility: hidden;
            opacity: 0;
        }
        #modalBox {
            display: flex;
            flex-direction: column;
            width: 85vw;
            min-height: : 60vh;
            border-radius: 1em;
            padding: 1em;
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 3em #300 inset;
        }
        @media screen and (min-width: 768px) {
            #modalBox {
                width: 700px;
                height: auto;
            }
        }
        h1 {
            font-size: 3em;
            font-family: "Orelega One", serif;
            font-weight: bold;
        }
        a {
            font-weight: bold;   
        }
        a:link, a:visited {
            color: #FFD900;
        }
        a:hover, a:active {
            color: #FFD900;
        }
        img#nano {
            height: 1em;
        }
        pre {
            font-size: 1em;
            user-select: all;
            white-space: pre-wrap;       /* css-3 */
            white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
        }
    </style>
    <title>Communism Button</title>
</head>
<body>
    <div id="container">
        <div id="content">
            <img draggable="false" unselectable="on" id="button" src="./button.svg" onclick="communism()"></img>
            <img draggable="false" unselectable="on" id="modalButton" src="./info.svg" ></img>
        </div>
    </div>

    <div id="modal" class="hidden">
        <div id="modalBox" class="hidden">
            <h1>Привет!</h1>
            <p>
                This is a progressive web app, you can <u>install it to use offline</u> like regular apps through your browser's menu.
            </p>
            <p style="flex-grow: 1;">
                This app was made for fun by <a href="https://twitter.com/wakedowsky">@wakedowsky</a>,
                check it out also on <a href="https://github.com/dzierzanowski/communism-button">GitHub</a>.
                Please note, that I <u>do not</u> support oppresive, criminal regimes.
            </p>
            <p>
                Consider donating some <a href="https://nano.org/"><img id="nano" src="./nano+mark.svg" />Nano</a>:
                <pre>nano_3gg4uhy96an4ah8w5snn8rijddwhnjk94j5f4irjyf8f6imtkwttnbqrj9ph</pre>
            </p>
        </div>
    </div>

    <script>
    // register ServiceWorker, remember to use absolute path!
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/communism-button/sw.js', {scope: '/communism-button/'})
        .then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope)
        }, err => {
            console.log('ServiceWorker registration failed: ', err)
        })
    }
    
    const content = document.getElementById('content')
    const modal = document.getElementById('modal')
    const modalBox = document.getElementById('modalBox')
    const button = document.getElementById('button')
    const modalButton = document.getElementById('modalButton')
    button.addEventListener('mousedown', press, false)
    button.addEventListener('touchstart', press, false)
    modalButton.addEventListener('mousedown', pressModal, false)
    modalButton.addEventListener('touchstart', pressModal, false)
    window.addEventListener('mouseup', release, false)
    window.addEventListener('touchend', release, false)
    window.ondragstart = function() { return false }

    button.oncontextmenu = function(e) { absorbLongPress(e); return false; }
    modalButton.oncontextmenu = function(e) { absorbLongPress(e); return false; }

    window.onload = () => {
        const anchor = window.location.hash
        if (anchor == "#about") {
            openModal()
        }
    }

    function absorbLongPress(e) {
        e.preventDefault && e.preventDefault()
        e.stopPropagation && e.stopPropagation()
        e.cancelBubble = true
        e.returnValue = false
    }

    const audio = new Audio("./communism.mp3")
    audio.load()
    function communism() {
        audio.play()
    }

    function openModal() {
        content.classList.add("modal-active")
        modal.classList.remove("hidden")
        modalBox.classList.remove("hidden")
        window.location.hash = "#about"
    }

    function closeModal() {
        content.classList.remove("modal-active");
        modal.classList.add("hidden")
        modalBox.classList.add("hidden")
        history.pushState(null, null, ' ')
    }

    function press(e) {
        communism()
        button.classList.add("pressed")
        absorbLongPress(e)
    }

    function release() {
        button.classList.remove("pressed")
        modalButton.classList.remove("pressed")
    }

    function pressModal(e) {
        modalButton.classList.add("pressed")
        openModal()
        absorbLongPress(e)
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            closeModal();
            // Fix glitch where Nano address is selected upon reopening of
            // the modal window.
            if (window.getSelection) {
                window.getSelection().removeAllRanges()
            } else if (document.selection) {
                document.selection.empty()
            }
        }
    }
    </script>
</body>
</html>
